<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="./mock.js"></script>
    <script src="./json2ast.js"></script>
    <script>
        const { Random } = Mock;

        // const data = Mock.mock({
        //     'code': '0',
        //     'msg': '@string(5)',
        //     'list|2': [
        //         {
        //             'id|+1': 1,
        //             'name': '@cname',
        //             'address': '@county(true)',
        //             'zip': '@zip'
        //         }
        //     ],
        //     'result|2': ['AMC', 1, 3]
        // })

        const data = Mock.mock({
            'code': '0',
            'msg': '@string(5)',
            'list|2': [
                {
                    'id|+1': 1,
                    'name': '@cname',
                    'address': '@county(true)',
                    'children': [
                        {
                            'uuid': '@guid',
                            'ip': '@ip',
                            'email': '@email',
                            'url': '@url'
                        }
                    ]
                }
            ],
            'result|2': ['AMC', 1, 3]
        })

        const ast = jsonToAst(JSON.stringify(data), { loc: false });

        console.log('data:', data);
        console.log('ast:', ast);

        /**
         * 数据类型
         */
        function typeOf(param) {
            const str = Object.prototype.toString.call(param);
            return str.slice(8, str.length - 1).toLocaleLowerCase();
        }

        /**
         * 递归将数据类型解析出来
         * Object: object
         * Property: object
         * Identifier: string;
         * Array: array;
         * Literal: string | number | boolean | null;
         */
         function convertToObject(data) {
            if (data.type === "Object") {
                let obj = {};
                data.children.forEach((child) => {
                    if (child.type === "Property") {
                        let key = child.key.value;
                        let value = convertToObject(child.value);
                        obj[key] = value;
                    }
                });
                return obj;
            } else if (data.type === "Array") {
                let arr = [];
                data.children.forEach((child) => {
                    if (child.type === "Object") {
                        let obj = convertToObject(child);
                        arr.push(obj);
                    } else if (child.type === "Literal" || child.type === 'Identifier') {
                        arr.push(child.value);
                    }
                });
                return arr;
            } else if (data.type === "Literal" || child.type === 'Identifier') {
                return data.value;
            }
        }

        function convertToMock(data) {
            if (data.type === "Object") {
                let obj = {};
                data.children.forEach((child) => {
                    if (child.type === "Property") {
                        let key = child.key.value;
                        let value = convertToMock(child.value);
                        obj[key] = value;
                    }
                });
                return obj;
            } else if (data.type === "Array") {
                let arr = [];
                data.children.forEach((child) => {
                    if (child.type === "Object") {
                        let obj = convertToMock(child);
                        arr.push(obj);
                    } else if (child.type === "Literal" || child.type === 'Identifier') {
                        arr.push(child.value);
                    }
                });
                return arr;
            } else if (data.type === "Literal" || child.type === 'Identifier') {
                return data.value;
            }
        }

        // console.log(convertToObject(ast));
        console.log(convertToMock(ast));

    </script>
</body>

</html>